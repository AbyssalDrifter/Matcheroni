#cpp_build_mode = -g -O0 -std=c++20 -DMATCHERONI_ENABLE_TRACE -DEXTRA_DEBUG
#cpp_build_mode = -g -O0 -std=c++20
#cpp_build_mode = -g -Og -std=c++20
#cpp_build_mode = -g -Os -std=c++20
cpp_build_mode = -O3 -std=c++20

rule compile_cpp
  command = g++ ${cpp_build_mode} ${includes} -MMD -MF ${out}.d -c ${in} -o ${out}
  depfile = ${out}.d
  deps = gcc

rule link
  command = g++ ${cpp_build_mode} ${in} -o ${out}

build obj/c_lexer.o        : compile_cpp matcheroni/c_lexer.cpp
build obj/c_parser.o       : compile_cpp matcheroni/c_parser.cpp
build obj/c_parser_test.o  : compile_cpp matcheroni/c_parser_test.cpp
build obj/c_reference.o    : compile_cpp matcheroni/c_reference.cpp
build obj/ParseNode.o      : compile_cpp matcheroni/ParseNode.cpp

build obj/c_reference_hax.o : compile_cpp matcheroni/c_reference_hax.cpp

build bin/c_parser_test : link $
  obj/c_lexer.o $
  obj/c_parser.o $
  obj/c_parser_test.o $
  obj/c_reference.o $
  obj/ParseNode.o


build obj/benchmark.o      : compile_cpp matcheroni/benchmark.cpp
build bin/benchmark        : link obj/benchmark.o
